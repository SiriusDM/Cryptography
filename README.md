# 密码学原理课程设计

## Problem 1 SPN实现

1. **SPN过程**

   1.1 轮密钥异或 

   1.2 S盒代换

   1.3 P盒置换

2. **SPN流程图**

   ![image-20200912111544083](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200912111544083.png)

   3. **代码流程**

      ![image-20200912111129562](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200912111129562.png)

      ![image-20200912111653181](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200912111653181.png)

   4. **优化**

      + 快速读入
      + S盒P盒打表

   ## Problem 2 SPN线性分析

   1. **算法流程**

      根据选定的线性逼近的链和给出的8000对明-密文对计算计数器，选取计数器最大的密钥对最为候选子密钥

      ![image-20200912125907253](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200912125907253.png)

      ![image-20200912125931230](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200912125931230.png)

   2. **过程**

      + 首先给出了一条关于K2，K4的链，直接使用而暴力剩余24位密钥超过要求时间的复杂度，考虑寻找第二条链用于减少枚举位数

      + 选取了一条链后，新选取的链涉及到4个密钥，需要以Count值高的候选子密钥设为已知来求K1,K3，由于选取的链性能不好，正确候选子密钥的Count值未必最高或同Count值的候选子密钥过多导致TLE

      + 考虑选取第三条链来修正K1,K3的值，处理同第二条链，取两条线性逼近的链的Count的绝对值之为作为K1,K3的key值排序，这样可以通过前7个测试点，最后三个点还是TLE。

      + 经过调整参数测试，发现给定的第一条链性能不够优秀，直接选取第4条链对K2,K4进行修正，处理同第一条链。

      + 最终再枚举剩余16位密钥

      + **K2,K4**  (x5,x7,x8)(u6,u8,u14,u16)

        ​			  (x13,x15)(u7,u15)

        **备选链**   (x9,x11)(u7,u15)

        **K1,K3**  (x1,x2,x4)(u1,u5,u9,u13)

        ​		     (x9,x10,x12)(u3,u7,u11,u15)

   3. **优化**

      + 快速读入
      + S盒P盒打表
      + 求出正确密钥后结束循环

   ## Problem 3 SPN 差分分析

   1. **算法流程**

      算法流程类似于线性分析

      ![image-20200917224635647](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200917224635647.png)

      不过对于选择所需的明-密文4元组，对于特殊的链，我们可以通过过滤操作提高效率

      ![image-20200917224951832](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200917224951832.png)

      Tips:这是对于性能足够优良的链而言，对于普通的链就无法使用过滤操作。

      2. **过程**

         + 有了线性分析的例子，决定对于求K1,K3直接多选取几条链提高效率
         + 类似于线性分析，我们不一定需要根据65536个明密文对来过滤和求K1,K3,可以根据OJ反馈信息，进行参数的调试

         + 同样我们可以限制过滤后的4元子明密文对数来提高效率
         + 一些减少常数的操作
         + 写完细节后测试的结果

         ![image-20200917230137752](C:/Users/zhl/AppData/Roaming/Typora/typora-user-images/image-20200917230137752.png)

      一开始考虑因为写法问题导致的最后一个点超时，怀疑是在求K1，K3的复杂度问题。

      测试后发现书中给的链足够优秀，考虑用确定K2的方法，和另一条23的链求K3,然后确定K2,K3,K4来求K1,这样在求K1,K3的时候只需要枚举16位即可。又减少了一些常数后进行测试，同时写了对拍器进行正确性的检测。

      ![image-20200917231030131](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200917231030131.png)

      优化了300ms左右，还差100+ms，基本没有想到其他的优化方法，经过漫长的调参后还是没有AC。

      询问同学后，得知简单的快读不足以支持复杂度，换**fgets读入**后测试

      ![image-20200917231244081](https://gitee.com/KinDog/picgo/raw/master/picture/image-20200917231244081.png)

      面对数据量较大的题目，首先需要考虑读入的最优化方法，对于本题，同一行又65536个数据，用fgets就比普通快读优化。

      3. **优化**
         + fgets读入
         + 对于性能不优良的链需要多选取几条用于提高准确性
         + 常数

   